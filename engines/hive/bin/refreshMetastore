#!/usr/bin/env bash

refreshMetastore () {
  #"$BIG_BENCH_BIN_DIR/bigBench" cleanMetastore $LIST_OF_USER_OPTIONS
  runEngineCmd -f "$BIG_BENCH_REFRESH_METASTORE_FILE"

  hadoop fs -mkdir -p "$BIG_BENCH_HDFS_ABSOLUTE_TEMP_DIR" &
  hadoop fs -mkdir -p "$BIG_BENCH_HDFS_ABSOLUTE_QUERY_RESULT_DIR" &
  wait
  hadoop fs -chmod ugo+rw "$BIG_BENCH_HDFS_ABSOLUTE_TEMP_DIR" &
  hadoop fs -chmod ugo+rw "$BIG_BENCH_HDFS_ABSOLUTE_QUERY_RESULT_DIR" &
  wait
}

helpModule () {
  echo "This module refreshes the metastore with the refresh dataset"
  echo
  echo "Options:"
  echo -e "-d\tdatabase to use"
  echo -e "-h\tshow this help"
  echo -e "-w\tsql script for metastore refresh"
  echo -e "-z\tfile with user defined engine settings"
}

runModule () {
  echo "==============================================="
  echo "Adding/Updating generated files to hive metastore"
  echo "==============================================="

  time (refreshMetastore ; echo "======= Load data into hive time =========") > >(tee -a "$BIG_BENCH_LOADING_STAGE_LOG") 2>&1 
  echo "==========================="

  echo "==============================================="
  echo "HIVE refresh finished."
  echo "==============================================="
}
